<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legatio Finance - Investissement Immobilier Tokenisé</title>
    <meta name="description" content="Investissez dans l’immobilier tokenisé dès 100$ avec Legatio Finance. Découvrez des rendements passifs jusqu’à 7% en 2025 grâce à la blockchain et aux NFTs.">
    <meta name="keywords" content="immobilier tokenisé, NFTs immobiliers, staking crypto, prêts crypto, blockchain, Legatio Finance">
    <meta name="author" content="Legatio Finance Team">
    <!-- Open Graph -->
    <meta property="og:title" content="Legatio Finance - Immobilier Tokenisé dès 100$">
    <meta property="og:description" content="Investissez dans l’immobilier tokenisé avec des rendements passifs via NFTs et staking sur Legatio Finance.">
    <meta property="og:image" content="https://delmarcrypto.github.io/legatio.finance/images/og-image.jpg">
    <meta property="og:url" content="https://delmarcrypto.github.io/legatio.finance/">
    <meta property="og:type" content="website">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <style>
        .crypto-prices { text-align: center; padding: 20px; background: #f9f9f9; border-radius: 8px; margin: 20px 0; }
        .crypto-prices h2 { font-size: 1.8em; margin-bottom: 15px; }
        .crypto-prices p { font-size: 1.2em; margin: 10px 0; }
        .simulator-form { max-width: 500px; margin: 20px auto; padding: 20px; background: #f9f9f9; border-radius: 8px; }
        .simulator-form label { display: block; margin-top: 10px; font-weight: bold; }
        .simulator-form input, .simulator-form select { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; }
        .simulator-form button { margin-top: 15px; }
        .hidden { display: none; }
        .section { padding: 40px 0; }
        .cta-button { display: inline-block; padding: 10px 20px; background: #2c3e50; color: white; text-decoration: none; border-radius: 5px; transition: background 0.3s; }
        .cta-button:hover { background: #34495e; }
        .token-sale { text-align: center; }
        .token-sale h2 { font-size: 1.8em; margin-bottom: 20px; }
        .token-sale-container { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; }
        .token-sale-item { flex: 1; min-width: 300px; background: #f9f9f9; padding: 20px; border-radius: 8px; text-align: left; }
        .token-sale-item h3 { font-size: 1.4em; margin-bottom: 10px; }
        .token-sale-item ul { list-style-type: disc; padding-left: 20px; margin-bottom: 15px; }
        .token-sale-item p { margin: 5px 0; }
        .token-sale-item .cta-button { margin-top: 15px; }
        .team { text-align: center; }
        .team h2 { font-size: 1.8em; margin-bottom: 20px; }
        .team-container { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; }
        .team-member { flex: 1; min-width: 250px; background: #f9f9f9; padding: 20px; border-radius: 8px; text-align: center; }
        .team-member h3 { font-size: 1.4em; margin-bottom: 5px; }
        .team-member p { margin: 5px 0; color: #555; }
        #loading-spinner { margin-left: 5px; }
        #network-status, #error-message { margin-top: 5px; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <ul>
                <li><a href="#start">Accueil</a></li>
                <li><a href="#how-to-invest">Solutions</a></li>
                <li><a href="#investors">Investisseurs</a></li>
                <li><a href="#faq">FAQ</a></li>
                <li><a href="#team">Équipe</a></li>
            </ul>
        </div>
    </nav>

    <header class="header">
        <div class="header-content">
            <h1>Legatio Finance</h1>
            <p>Investissez dans l’immobilier tokenisé dès 100$ avec des rendements passifs en 2025.</p>
            <a href="#start" class="cta-button" aria-label="Découvrir les offres">Découvrir Maintenant</a>
        </div>
    </header>

    <div class="container">
        <section id="start" class="section start-section">
            <h2>Bienvenue chez Legatio Finance</h2>
            <p>Découvrez une plateforme innovante pour investir dans l’immobilier tokenisé avec sécurité et simplicité grâce à la blockchain.</p>
        </section>

        <div class="section before-after">
            <h2>Avant et Après</h2>
            <div class="before-after-content">
                <div class="before">
                    <h3>❌ Avant</h3>
                    <ul>
                        <li>Accès limité par les banques.</li>
                        <li>Capital élevé requis.</li>
                        <li>Processus lent.</li>
                    </ul>
                </div>
                <div class="after">
                    <h3>✅ Après</h3>
                    <ul>
                        <li>Accès via blockchain.</li>
                        <li>Investissement dès 100$.</li>
                        <li>Processus rapide.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section why-choose">
            <h2>Pourquoi Nous Choisir ?</h2>
            <div class="why-choose-list">
                <div class="why-choose-item">
                    <i class="fas fa-unlock-alt fa-2x"></i>
                    <h3>Accessibilité</h3>
                    <p>Investissez dès 100$ avec NFTs.</p>
                </div>
                <div class="why-choose-item">
                    <i class="fas fa-chart-line fa-2x"></i>
                    <h3>Rendements</h3>
                    <p>5-7% par an via staking.</p>
                </div>
                <div class="why-choose-item">
                    <i class="fas fa-shield-alt fa-2x"></i>
                    <h3>Sécurité</h3>
                    <p>Audits CertiK et KYC/AML.</p>
                </div>
            </div>
        </div>

        <div id="how-to-invest" class="section how-to-invest">
            <h2>Comment Investir dans l’Immobilier Tokenisé ?</h2>
            <div class="how-to-invest-steps">
                <div class="how-to-invest-step">
                    <i class="fas fa-wallet fa-2x"></i>
                    <h3>1. Connectez</h3>
                    <p>Utilisez MetaMask.</p>
                </div>
                <div class="how-to-invest-step">
                    <i class="fas fa-building fa-2x"></i>
                    <h3>2. Achetez</h3>
                    <p>Parts d’immeubles NFTs.</p>
                </div>
                <div class="how-to-invest-step">
                    <i class="fas fa-money-bill-wave fa-2x"></i>
                    <h3>3. Gagnez</h3>
                    <p>Stakez pour des rendements.</p>
                </div>
            </div>
            <a href="#simulateur-rwa" class="cta-button">Démarrez avec MetaMask</a>
        </div>

        <div class="section services">
            <h2>Nos Solutions d’Investissement</h2>
            <div class="service-list">
                <div class="service-item">
                    <i class="fas fa-gem fa-2x"></i>
                    <h3>NFTs Immobiliers</h3>
                    <p>À partir de 100$ par part.</p>
                </div>
                <div class="service-item">
                    <i class="fas fa-coins fa-2x"></i>
                    <h3>Staking LEG</h3>
                    <p>Rendements de 5% annuel.</p>
                </div>
                <div class="service-item">
                    <i class="fas fa-hand-holding-usd fa-2x"></i>
                    <h3>Prêts Crypto</h3>
                    <p>Emprunts sécurisés.</p>
                </div>
            </div>
        </div>

        <div class="section token-sale">
            <h2>Vente de Tokens</h2>
            <div class="token-sale-container">
                <div class="token-sale-item">
                    <h3>Token LEG</h3>
                    <p><strong>$LEG</strong> est le cœur de l’écosystème Legatio. Ce token utilitaire vous permet :</p>
                    <ul>
                        <li>D’accéder à des prêts sécurisés basés sur vos actifs tokenisés.</li>
                        <li>De générer des rendements passifs via staking (jusqu’à 5-7% annuel).</li>
                        <li>De participer à la gouvernance décentralisée de la plateforme.</li>
                    </ul>
                    <p><strong>Tokenomics :</strong></p>
                    <p>Total Supply : 100 000 000 LEG</p>
                    <p>Distribution : 40% réservés au staking, 25% pour la liquidité, 20% pour le développement, 10% pour l’équipe, 5% pour les partenariats stratégiques.</p>
                    <a href="#investors" class="cta-button" aria-label="Investir maintenant">Investir Maintenant</a>
                </div>
                <div class="token-sale-item">
                    <h3>NFTs Legatio</h3>
                    <p><strong>Collection "Legatio Genesis" :</strong> Une série exclusive de 1 000 NFTs uniques déployés sur Arbitrum.</p>
                    <p>Prix de Mint : 0.2 ETH</p>
                    <p>Lancement prévu : Q3 2025.</p>
                    <p><strong>Avantages :</strong> Réduction des frais de transaction, accès anticipé aux nouvelles opportunités, droits de gouvernance.</p>
                    <a href="#opportunites" class="cta-button" aria-label="Voir les opportunités">Voir les Opportunités</a>
                </div>
            </div>
        </div>

        <div id="team" class="section team">
            <h2>Notre Équipe</h2>
            <div class="team-container">
                <div class="team-member">
                    <h3>Rodrigues Delmar</h3>
                    <p>Co-fondateur & CEO</p>
                    <p>Expert en trading crypto et blockchain avec plus de 10 ans d’expérience dans les marchés financiers décentralisés.</p>
                </div>
                <div class="team-member">
                    <h3>Alexandre Perez</h3>
                    <p>CTO</p>
                    <p>Ingénieur blockchain spécialisé en smart contracts, ayant développé des solutions sur Ethereum et Arbitrum.</p>
                </div>
                <div class="team-member">
                    <h3>Marie Balsan</h3>
                    <p>COO</p>
                    <p>Experte en régulation et conformité crypto, assurant l’alignement avec les normes KYC/AML internationales.</p>
                </div>
            </div>
        </div>

        <div class="section crypto-prices">
            <h2>Prix en Direct</h2>
            <p id="btcPrice">Bitcoin: Chargement...</p>
            <p id="goldPrice">Or: Chargement...</p>
            <p id="silverPrice">Argent: Chargement...</p>
        </div>

        <section id="simulateur-rwa" class="section">
            <h2>Simulateur de Prêt RWA</h2>
            <p>Calculez votre prêt en fonction de vos actifs tokenisés.</p>
            <div class="simulator-form">
                <button id="connect-metamask" class="cta-button">Connecter MetaMask <span id="loading-spinner" class="hidden">⏳</span></button>
                <p id="wallet-address" class="hidden">Adresse connectée : Aucune</p>
                <p id="network-status" class="hidden" style="color: #e74c3c;"></p>
                <p id="error-message" class="hidden" style="color: #e74c3c;"></p>
                <label>Type de Collatéral :</label>
                <select id="collateral-type" class="w-full p-2 border rounded">
                    <option value="bitcoin">Bitcoin</option>
                    <option value="pax-gold">Or (PAXG)</option>
                    <option value="slv-token">Argent (SLV)</option>
                    <option value="immobilier">Immobilier</option>
                </select>
                <label>Valeur du Collatéral (en unités) :</label>
                <input type="number" id="collateral-amount" class="w-full p-2 border rounded" placeholder="Ex: 2 BTC">
                <p>Prix actuel : <span id="collateral-price">$0</span></p>
                <label>Durée du Prêt (mois) :</label>
                <input type="number" id="loan-duration" class="w-full p-2 border rounded" placeholder="Ex: 12">
                <label>Taux d’Intérêt Annuel (%) :</label>
                <input type="number" id="interest-rate" class="w-full p-2 border rounded" placeholder="Ex: 5">
                <p>Ratio LTV : <span id="ltv-value">0%</span></p>
                <button onclick="calculateLoan()" class="cta-button">Calculer</button>
                <div id="loan-results"></div>
                <button onclick="requestLoan()" class="cta-button hidden" id="loan-request-btn">Demander un prêt</button>
            </div>
        </section>

        <div class="section about">
            <h2>À Propos de Legatio Finance</h2>
            <p>Legatio Finance est une plateforme pionnière dans la tokenisation immobilière, offrant des solutions accessibles et sécurisées grâce à la blockchain. Audités par CertiK et conformes aux normes KYC/AML, nous visons à démocratiser l’investissement immobilier.</p>
        </div>

        <div class="section faq" id="faq">
            <h2>Questions Fréquentes</h2>
            <div class="faq-list">
                <div class="faq-item">
                    <h3>Comment acheter un NFT immobilier ?</h3>
                    <p>Connectez votre portefeuille MetaMask, sélectionnez un NFT de la collection "Legatio Genesis" sur notre plateforme, et payez en stablecoins (ex. USDT, USDC) ou ETH. Le processus est rapide et sécurisé.</p>
                </div>
                <div class="faq-item">
                    <h3>Quels sont les risques ?</h3>
                    <p>Comme tout investissement crypto, les variations du marché peuvent affecter la valeur des actifs. Cependant, nos audits CertiK et notre transparence minimisent les risques opérationnels.</p>
                </div>
                <div class="faq-item">
                    <h3>Comment retirer mes gains ?</h3>
                    <p>Utilisez notre DApp sécurisée pour retirer vos rendements de staking ou prêts en connectant votre portefeuille. Les fonds sont transférés directement en stablecoins ou ETH.</p>
                </div>
            </div>
        </div>

        <div class="section learn">
            <h2>Apprenez l’Immobilier Tokenisé</h2>
            <p>Découvrez nos guides pour débutants : <a href="#faq">Qu’est-ce qu’un NFT immobilier ?</a> | <a href="#how-to-invest">Comment investir avec Legatio ?</a></p>
        </div>

        <div id="investors" class="section investors">
            <h2>Pour les Investisseurs</h2>
            <p>Explorez notre vision innovante pour la finance décentralisée.</p>
            <div class="investor-buttons">
                <a href="./PitchDeck.pdf" class="cta-button" target="_blank" aria-label="Télécharger le Pitch Deck">Pitch Deck</a>
                <a href="./WhitePaper.pdf" class="cta-button" target="_blank" aria-label="Télécharger le White Paper">White Paper</a>
                <a href="#" class="cta-button" id="open-demo-modal" aria-label="Demander une démo">Demander une Démo</a>
            </div>
        </div>

        <div class="section stay-informed">
            <h2>Rejoignez la Révolution</h2>
            <p>Inscrivez-vous pour recevoir nos mises à jour exclusives.</p>
            <div class="stay-informed-actions">
                <a href="https://forms.zoho.eu/legatiofinancegm1/form/FormationLegatio" class="cta-button" target="_blank" aria-label="S’inscrire">S’inscrire Maintenant</a>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="social-links">
                <a href="https://x.com/rdb_legend" target="_blank" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                <a href="https://discord.com/channels/1347668715357077577/1347668716120182888" target="_blank" aria-label="Discord"><i class="fab fa-discord"></i></a>
            </div>
            <div class="footer-links">
                <a href="#faq">FAQ</a> | <a href="#privacy">Politique de Confidentialité</a> | <a href="#terms">Conditions Générales</a>
            </div>
            <div class="footer-contact">
                <p>Contact : <a href="mailto:legatio.finance@gmail.com">legatio.finance@gmail.com</a> | © 2025 Legatio Finance</p>
            </div>
            <a href="#" class="back-to-top" aria-label="Retour en haut">↑</a>
        </div>
    </footer>

    <!-- Modale pour la capture de leads -->
    <div id="demo-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="close-demo-modal">×</span>
            <h2>Demander une Démo</h2>
            <p>Remplissez le formulaire ci-dessous pour planifier une démo avec notre équipe.</p>
            <div id="form-message" style="display: none; color: #2c3e50; margin-bottom: 20px;"></div>
            <form id="demo-form" action="https://formspree.io/f/mpwpavjj" method="POST">
                <div class="form-group">
                    <label for="name">Nom :</label>
                    <input type="text" id="name" name="name" required placeholder="Votre nom">
                </div>
                <div class="form-group">
                    <label for="email">Email :</label>
                    <input type="email" id="email" name="email" required placeholder="Votre email">
                </div>
                <div class="form-group">
                    <label for="message">Message (optionnel) :</label>
                    <textarea id="message" name="message" placeholder="Dites-nous en plus..."></textarea>
                </div>
                <button type="submit" class="cta-button">Envoyer</button>
            </form>
        </div>
    </div>

    <!-- Balisage Schema.org pour FAQ -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Comment acheter un NFT immobilier ?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Connectez votre portefeuille MetaMask, sélectionnez un NFT de la collection 'Legatio Genesis' sur notre plateforme, et payez en stablecoins (ex. USDT, USDC) ou ETH. Le processus est rapide et sécurisé."
          }
        },
        {
          "@type": "Question",
          "name": "Quels sont les risques ?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Comme tout investissement crypto, les variations du marché peuvent affecter la valeur des actifs. Cependant, nos audits CertiK et notre transparence minimisent les risques opérationnels."
          }
        },
        {
          "@type": "Question",
          "name": "Comment retirer mes gains ?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Utilisez notre DApp sécurisée pour retirer vos rendements de staking ou prêts en connectant votre portefeuille. Les fonds sont transférés directement en stablecoins ou ETH."
          }
        }
      ]
    }
    </script>

    <script>
        let livePrices = {
            'bitcoin': 0,
            'pax-gold': 0,
            'slv-token': 0,
            'immobilier': 1000
        };

        async function fetchLivePrices() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,pax-gold,slv-token&vs_currencies=usd');
                const data = await response.json();
                livePrices['bitcoin'] = data['bitcoin']?.usd || 0;
                livePrices['pax-gold'] = data['pax-gold']?.usd || 0;
                livePrices['slv-token'] = data['slv-token']?.usd || 0;
                document.getElementById('btcPrice').textContent = `Bitcoin: $${livePrices['bitcoin'].toLocaleString('fr-FR', { maximumFractionDigits: 2 })}`;
                document.getElementById('goldPrice').textContent = `Or: $${livePrices['pax-gold'].toLocaleString('fr-FR', { maximumFractionDigits: 2 })} / oz`;
                document.getElementById('silverPrice').textContent = `Argent: $${livePrices['slv-token'].toLocaleString('fr-FR', { maximumFractionDigits: 2 })} / oz`;
                updateCollateralPrice();
            } catch (error) {
                console.error('Erreur lors de la récupération des prix:', error);
                document.getElementById('btcPrice').textContent = 'Bitcoin: Prix indisponible';
                document.getElementById('goldPrice').textContent = 'Or: Prix indisponible';
                document.getElementById('silverPrice').textContent = 'Argent: Prix indisponible';
            }
        }

        function updateCollateralPrice() {
            const collateralType = document.getElementById('collateral-type').value;
            const price = livePrices[collateralType];
            document.getElementById('collateral-price').textContent = `$${price.toLocaleString('fr-FR', { maximumFractionDigits: 2 })}`;
        }

        function calculateLoan() {
            const collateralType = document.getElementById('collateral-type').value;
            const collateralAmount = parseFloat(document.getElementById('collateral-amount').value) || 0;
            const loanDuration = parseFloat(document.getElementById('loan-duration').value) || 0;
            const interestRate = parseFloat(document.getElementById('interest-rate').value) || 0;
            const collateralValue = collateralAmount * livePrices[collateralType];
            const ltv = 0.7;
            const loanAmount = collateralValue * ltv;
            const monthlyInterestRate = interestRate / 100 / 12;
            const monthlyPayment = (loanAmount * monthlyInterestRate) / (1 - Math.pow(1 + monthlyInterestRate, -loanDuration));
            const totalPayment = monthlyPayment * loanDuration;
            const totalInterest = totalPayment - loanAmount;

            document.getElementById('ltv-value').textContent = `${(ltv * 100).toFixed(0)}%`;
            const resultsDiv = document.getElementById('loan-results');
            if (collateralAmount > 0 && loanDuration > 0 && interestRate > 0) {
                resultsDiv.innerHTML = `
                    <p><strong>Montant du prêt :</strong> $${loanAmount.toLocaleString('fr-FR', { maximumFractionDigits: 2 })}</p>
                    <p><strong>Paiement mensuel :</strong> $${monthlyPayment.toLocaleString('fr-FR', { maximumFractionDigits: 2 })}</p>
                    <p><strong>Total des intérêts :</strong> $${totalInterest.toLocaleString('fr-FR', { maximumFractionDigits: 2 })}</p>
                    <p><strong>Total à rembourser :</strong> $${totalPayment.toLocaleString('fr-FR', { maximumFractionDigits: 2 })}</p>
                `;
                document.getElementById('loan-request-btn').classList.remove('hidden');
            } else {
                resultsDiv.innerHTML = '<p style="color: red;">Veuillez remplir tous les champs correctement.</p>';
                document.getElementById('loan-request-btn').classList.add('hidden');
            }
        }

        async function connectMetaMask() {
            const connectButton = document.getElementById('connect-metamask');
            const loadingSpinner = document.getElementById('loading-spinner');
            const walletAddress = document.getElementById('wallet-address');
            const networkStatus = document.getElementById('network-status');
            const errorMessage = document.getElementById('error-message');

            // Réinitialiser les messages
            walletAddress.classList.add('hidden');
            networkStatus.classList.add('hidden');
            errorMessage.classList.add('hidden');

            // Vérification approfondie de MetaMask
            if (!window.ethereum) {
                console.error("MetaMask non détecté : window.ethereum est undefined");
                errorMessage.classList.remove('hidden');
                errorMessage.textContent = "MetaMask n’est pas détecté. Veuillez vérifier que l’extension est installée et activée.";
                return;
            }

            if (!window.ethereum.isMetaMask) {
                console.error("L'objet window.ethereum n'est pas MetaMask");
                errorMessage.classList.remove('hidden');
                errorMessage.textContent = "L’extension détectée n’est pas MetaMask. Veuillez utiliser MetaMask.";
                return;
            }

            try {
                loadingSpinner.classList.remove('hidden');
                connectButton.disabled = true;

                // Vérifier si MetaMask est verrouillé
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length === 0) {
                    console.log("MetaMask est verrouillé ou aucun compte n’est connecté");
                    // Demander la connexion
                    const newAccounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    if (newAccounts.length === 0) {
                        throw new Error("Aucun compte n’a été autorisé.");
                    }
                    accounts.push(...newAccounts);
                }

                const account = accounts[0];
                walletAddress.classList.remove('hidden');
                walletAddress.textContent = `Adresse connectée : ${account.slice(0, 6)}...${account.slice(-4)}`;

                // Vérification du réseau (Arbitrum One : 0xa4b1)
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                console.log("Chain ID détecté :", chainId);
                if (chainId !== '0xa4b1') {
                    networkStatus.classList.remove('hidden');
                    networkStatus.textContent = 'Veuillez passer au réseau Arbitrum pour continuer.';
                    walletAddress.classList.add('hidden');
                } else {
                    networkStatus.classList.add('hidden');
                    connectButton.textContent = 'MetaMask Connecté';
                }
            } catch (error) {
                console.error('Erreur détaillée lors de la connexion à MetaMask:', error);
                errorMessage.classList.remove('hidden');
                if (error.code === 4001) {
                    errorMessage.textContent = 'Connexion refusée : Vous avez annulé la demande de connexion.';
                } else if (error.code === -32002) {
                    errorMessage.textContent = 'Une demande de connexion est déjà en cours. Vérifiez MetaMask.';
                } else {
                    errorMessage.textContent = `Erreur : ${error.message || 'Problème inconnu lors de la connexion à MetaMask.'}`;
                }
            } finally {
                loadingSpinner.classList.add('hidden');
                connectButton.disabled = false;
            }
        }

        function requestLoan() {
            const connectButton = document.getElementById('connect-metamask');
            if (connectButton.textContent === 'MetaMask Connecté') {
                alert('Demande de prêt initiée ! Vérifiez votre portefeuille MetaMask pour confirmer la transaction.');
            } else {
                alert('Veuillez connecter MetaMask avant de demander un prêt.');
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            fetchLivePrices();
            setInterval(fetchLivePrices, 60000);
            document.getElementById('collateral-type').addEventListener('change', updateCollateralPrice);
            updateCollateralPrice();
            document.getElementById('connect-metamask').addEventListener('click', connectMetaMask);

            gsap.from(".section", { opacity: 0, y: 50, duration: 1, stagger: 0.3, scrollTrigger: { trigger: ".section", start: "top 90%" } });
            const buttons = document.querySelectorAll('.cta-button');
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    gsap.to(button, { scale: 1.1, duration: 0.3, yoyo: true });
                });
            });

            document.querySelector('.back-to-top').addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            const modal = document.getElementById('demo-modal');
            const openModalBtn = document.getElementById('open-demo-modal');
            const closeModalBtn = document.getElementById('close-demo-modal');
            const form = document.getElementById('demo-form');
            const formMessage = document.getElementById('form-message');

            openModalBtn.addEventListener('click', (e) => {
                e.preventDefault();
                modal.style.display = 'block';
                gsap.fromTo(modal, { opacity: 0, scale: 0.9 }, { opacity: 1, scale: 1, duration: 0.3 });
            });

            closeModalBtn.addEventListener('click', () => {
                gsap.to(modal, { opacity: 0, scale: 0.9, duration: 0.3, onComplete: () => {
                    modal.style.display = 'none';
                    formMessage.style.display = 'none';
                    form.reset();
                } });
            });

            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    gsap.to(modal, { opacity: 0, scale: 0.9, duration: 0.3, onComplete: () => {
                        modal.style.display = 'none';
                        formMessage.style.display = 'none';
                        form.reset();
                    } });
                }
            });

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                try {
                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: formData,
                        headers: { 'Accept': 'application/json' }
                    });
                    if (response.ok) {
                        formMessage.style.display = 'block';
                        formMessage.style.color = '#2c3e50';
                        formMessage.textContent = 'Merci ! Nous vous contacterons bientôt.';
                        form.reset();
                    } else {
                        formMessage.style.display = 'block';
                        formMessage.style.color = '#e74c3c';
                        formMessage.textContent = 'Une erreur s’est produite. Veuillez réessayer.';
                    }
                } catch (error) {
                    formMessage.style.display = 'block';
                    formMessage.style.color = '#e74c3c';
                    formMessage.textContent = 'Une erreur s’est produite. Veuillez réessayer.';
                }
            });
        });
    </script>
</body>
</html>
